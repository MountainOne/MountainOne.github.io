<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>自己动手写Shell(一）——C实现 - MountainOne&#39;s technology space</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="本文参考自Write a Shell in C   Shell的基本生命周期  让我们自顶向下的思考一下 Shell。一个 Shell 在它的生命周期里主要做了三件事。  初始化：Shell 会在初始化时读入和执行配置文件。这会改变 Shell 接下来各方面的行为。  解释：Shell 在解释阶段（也就是等待用户输入的阶段）读入标准输入的命令并解释执行。  终结：在用户输入 shutdown 命">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="自己动手写Shell(一）——C实现">
<meta property="og:url" content="http://yoursite.com/2018/12/10/自己动手写Shell——C实现/index.html">
<meta property="og:site_name" content="MountainOne&#39;s technology space">
<meta property="og:description" content="本文参考自Write a Shell in C   Shell的基本生命周期  让我们自顶向下的思考一下 Shell。一个 Shell 在它的生命周期里主要做了三件事。  初始化：Shell 会在初始化时读入和执行配置文件。这会改变 Shell 接下来各方面的行为。  解释：Shell 在解释阶段（也就是等待用户输入的阶段）读入标准输入的命令并解释执行。  终结：在用户输入 shutdown 命">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-12-23T06:31:04.504Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="自己动手写Shell(一）——C实现">
<meta name="twitter:description" content="本文参考自Write a Shell in C   Shell的基本生命周期  让我们自顶向下的思考一下 Shell。一个 Shell 在它的生命周期里主要做了三件事。  初始化：Shell 会在初始化时读入和执行配置文件。这会改变 Shell 接下来各方面的行为。  解释：Shell 在解释阶段（也就是等待用户输入的阶段）读入标准输入的命令并解释执行。  终结：在用户输入 shutdown 命">





<link rel="icon" href="/images/wangye.jpeg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/wangye.jpeg" alt="自己动手写Shell(一）——C实现" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="/tags">Tags</a>
                
                <a class="navbar-item" href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/MountainOne">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-12-10T14:47:26.000Z">2018-12-10</time>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                自己动手写Shell(一）——C实现
            
        </h1>
        <div class="content">
            <blockquote>
<p>本文参考自<a href="https://brennan.io/2015/01/16/write-a-shell-in-c/" target="_blank" rel="noopener">Write a Shell in C</a> </p>
</blockquote>
<h2 id="Shell的基本生命周期"><a href="#Shell的基本生命周期" class="headerlink" title="Shell的基本生命周期"></a>Shell的基本生命周期</h2><p>  让我们自顶向下的思考一下 Shell。一个 Shell 在它的生命周期里主要做了三件事。</p>
<ul>
<li><p>初始化：Shell 会在初始化时读入和执行配置文件。这会改变 Shell 接下来各方面的行为。</p>
</li>
<li><p>解释：Shell 在解释阶段（也就是等待用户输入的阶段）读入标准输入的命令并解释执行。</p>
</li>
<li><p>终结：在用户输入 shutdown 命令后，Shell 会释放掉占用的内存并终结自己。</p>
<a id="more"></a>
</li>
</ul>
<p>这些步骤是很通用的，它们可以应用在任何程序中，我们将在我们的 Shell 中利用它们作为基础。我们的 Shell会足够简单，以至于没有任何配置文件，也不会有任何 shutdown 命令。因此，我们仅仅调用循环函数然后结束它。但需要注意的是，在程序的生命周期中循环只是一个基础的组成部分，真正的架构往往会复杂的多。</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-comment">// Load config files, if any.</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">// Run command loop.</span></span><br><span class="line">  lsh_loop();</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">// Perform any shutdown/cleanup.</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以在上面的代码中看到，我只使用了一个函数，lsh_loop()。它将会循环执行并解释命令。我们将在接下来的部分看到它的具体实现。</p>
<h2 id="Shell-的基本循环"><a href="#Shell-的基本循环" class="headerlink" title="Shell 的基本循环"></a>Shell 的基本循环</h2><p>我们已经思考过 Shell 程序是如何启动的。现在，考虑基本的程序逻辑：Shell 在执行循环的时候做了什么？</p>
<p>答案是以下三点：</p>
<ul>
<li>读入：从标准输入中读入命令</li>
<li>解析：将执行的命令和其参数解析出来输入程序执行</li>
<li>执行：根据命令和参数执行程序</li>
</ul>
<p>将以上三点表述成代码放入 lsh_loop():</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lsh_loop</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">char</span> *line;</span><br><span class="line">  <span class="hljs-keyword">char</span> **args;</span><br><span class="line">  <span class="hljs-keyword">int</span> status;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">do</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"&gt; "</span>);</span><br><span class="line">    line = lsh_read_line();</span><br><span class="line">    args = lsh_split_line(line);</span><br><span class="line">    status = lsh_execute(args);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-built_in">free</span>(line);</span><br><span class="line">    <span class="hljs-built_in">free</span>(args);</span><br><span class="line">  &#125; <span class="hljs-keyword">while</span> (status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>让我们看看这段代码。开头是几行声明语句。后面的 do-while 循环在检查变量的状态方面更加地方便，因为在检查之前就已经执行了一次了。在循环里，我们打印了一个提示符，调用了一个函数来读入一行，再调用了一个函数来划分读入行的参数，然后执行这些参数。最后我们释放了 line 和 arguments 变量。注意我们使用了一个状态变量 status （由 lsh_execute()返回）来决定何时终止循环。</p>
<h2 id="读入一行"><a href="#读入一行" class="headerlink" title="读入一行"></a>读入一行</h2><p>从标准输入中读入一行听起来简单，但用 C 实现起来还是有点麻烦的。难受的事情是，你并不知道在这一段时间里用户会往 shell 中输入多少文本。你不能简单地就分配一个块并期望输入不会溢出。而是要在启动的时候分配一个块，然后在溢出的时候重新分配更多的空间。这在 C 里是一个普遍的策略，我们将会在 lsh_read_line()中实现。</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LSH_RL_BUFSIZE 1024</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">char</span> *<span class="hljs-title">lsh_read_line</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">int</span> bufsize = LSH_RL_BUFSIZE;</span><br><span class="line">  <span class="hljs-keyword">int</span> position = <span class="hljs-number">0</span>;</span><br><span class="line">  <span class="hljs-keyword">char</span> *buffer = <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>) * bufsize);</span><br><span class="line">  <span class="hljs-keyword">int</span> c;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (!buffer) &#123;</span><br><span class="line">    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"lsh: allocation error\n"</span>);</span><br><span class="line">    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;</span><br><span class="line">    <span class="hljs-comment">// Read a character</span></span><br><span class="line">    c = getchar();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// If we hit EOF, replace it with a null character and return.</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (c == EOF || c == <span class="hljs-string">'\n'</span>) &#123;</span><br><span class="line">      buffer[position] = <span class="hljs-string">'\0'</span>;</span><br><span class="line">      <span class="hljs-keyword">return</span> buffer;</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">      buffer[position] = c;</span><br><span class="line">    &#125;</span><br><span class="line">    position++;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// If we have exceeded the buffer, reallocate.</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (position &gt;= bufsize) &#123;</span><br><span class="line">      bufsize += LSH_RL_BUFSIZE;</span><br><span class="line">      buffer = <span class="hljs-built_in">realloc</span>(buffer, bufsize);</span><br><span class="line">      <span class="hljs-keyword">if</span> (!buffer) &#123;</span><br><span class="line">        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"lsh: allocation error\n"</span>);</span><br><span class="line">        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一部分有很多的声明。函数的主要内容在<code>while(1)</code>循环中（显然是无限循环）。在循环中，我们读入一个字符并把它存储为 <code>int</code> 而不是 <code>char</code> ，这很重要！EOF是一个 Integer，而不是一个 Character。如果你想在条件语句中检查它，就得把它声明为 <code>int</code>。这是一个 C 语言初学者普遍会犯的错误。如果读入的是一个新行或者 EOF，我们会终止当前的读入并返回。否则我们将读到的字符添加到缓存字符串中。</p>
<p>接下来，我们会判断新的字符是否会超过当前的缓存大小。如实是的话，我们在继续读入前重新分配我们的缓存大小（同时检查分配错误）。这些都是值得做的。</p>
<p>对较新版本 C 函数库比较熟悉的人可能会察觉到在 <code>stdio.h</code> 中的 <code>getline()</code> 可以完成大部分我们实现的功能。但是尝试着自己实现一下 C 标准库的函数也没什么不好。使用 <code>getline</code> 的代码如下：</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">char</span> *<span class="hljs-title">lsh_read_line</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">char</span> *line = <span class="hljs-literal">NULL</span>;</span><br><span class="line">  <span class="hljs-keyword">ssize_t</span> bufsize = <span class="hljs-number">0</span>; <span class="hljs-comment">// have getline allocate a buffer for us</span></span><br><span class="line">  getline(&amp;line, &amp;bufsize, <span class="hljs-built_in">stdin</span>);</span><br><span class="line">  <span class="hljs-keyword">return</span> line;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="解析一行"><a href="#解析一行" class="headerlink" title="解析一行"></a>解析一行</h2><p>现在我们再看最初的循环，我们已经实现了 lsh_read_line()，所以可以获取读入的行了。之后我们需要把读入的行解析为一系列参数。这里我将做一些简化，不允许在命令行参数中出现引号和反斜杠，而是简单地通过空格来分隔每一个参数。因此命令<code>echo &quot;this message&quot;</code> 将不会通过一个参数调用<code>echo</code>，而是通过两个参数<code>&quot;this&quot;</code>和<code>message&quot;</code>调用。</p>
<p>在这些简化后，我们需要做的就是使用空格作为分隔符来对输入字符串做词法分析。这意味着我们可以调用标准库函数 strtok 来为我们做一些麻烦的事。</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LSH_TOK_BUFSIZE 64</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LSH_TOK_DELIM <span class="hljs-meta-string">" \t\r\n\a"</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">char</span> **<span class="hljs-title">lsh_split_line</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *line)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">int</span> bufsize = LSH_TOK_BUFSIZE, position = <span class="hljs-number">0</span>;</span><br><span class="line">  <span class="hljs-keyword">char</span> **tokens = <span class="hljs-built_in">malloc</span>(bufsize * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>*));</span><br><span class="line">  <span class="hljs-keyword">char</span> *token;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (!tokens) &#123;</span><br><span class="line">    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"lsh: allocation error\n"</span>);</span><br><span class="line">    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  token = strtok(line, LSH_TOK_DELIM);</span><br><span class="line">  <span class="hljs-keyword">while</span> (token != <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">    tokens[position] = token;</span><br><span class="line">    position++;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (position &gt;= bufsize) &#123;</span><br><span class="line">      bufsize += LSH_TOK_BUFSIZE;</span><br><span class="line">      tokens = <span class="hljs-built_in">realloc</span>(tokens, bufsize * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>*));</span><br><span class="line">      <span class="hljs-keyword">if</span> (!tokens) &#123;</span><br><span class="line">        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"lsh: allocation error\n"</span>);</span><br><span class="line">        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    token = strtok(<span class="hljs-literal">NULL</span>, LSH_TOK_DELIM);</span><br><span class="line">  &#125;</span><br><span class="line">  tokens[position] = <span class="hljs-literal">NULL</span>;</span><br><span class="line">  <span class="hljs-keyword">return</span> tokens;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码看起来和之前的 <code>lsh_read_line()</code> 很类似，我们使用了同样的缓存和动态拓展策略。但这一次我们使用了 null 终结的指针数组而不是 null 终结的字符数组。</p>
<p>在一开始，我们调用了<code>strtok</code>来划分词元。它返回第一个词元的指针。<code>strtok()</code> 事实上做的是返回你给的字符串内部的指针，并将每一个词元的末尾（分割符所在地址）置<code>\0</code> （C语言中表示字符串结束的标志）。我们将每一个字符指针保存在 tokens 中。</p>
<p>最后，我们在需要的时候重新分配内存。这个过程将会重复进行直到所有的词元都被<code>strtok</code>返回，然后将 null 放在 tokens 末尾。</p>
<p>现在我们有了一组词元了，可以准备开始执行了。</p>
<h2 id="Shell-启动进程"><a href="#Shell-启动进程" class="headerlink" title="Shell 启动进程"></a>Shell 启动进程</h2><p>现在我们来到了编写 Shell 的关键。启动线程是 Shell 的主要功能。所以编写一个 shell 意味着你需要明确地知道线程里发生了什么以及它们如何启动。因此在正式开写之前谈一谈 Unix 中的线程是很有必要的。</p>
<p>在 Unix 中仅有两种启动线程的方式。第一种是 Init 进程。当 unix 电脑启动时，它的内核会被加载。一旦内核被加载并初始化后，内核将会启动唯一的一个进程，Init 进程。Init 进程会在电脑启动后一直运行，并管理加载剩下的你所需要的进程。</p>
<p>因为大部分程序都不是 Init 进程，那么就只有一种常用的方式来启动进程了：<code>fork()</code> 系统调用。当这个函数被调用后，操作系统会构建一个该进程的副本并启动它。原进程称为父进程，新进程称为子进程。<code>fork()</code> 对子进程返回0，对父进程返回子进程的进程ID数（PID）。这意味着启动新进程的唯一方式是通过一个已存在的进程复制它自己并启动。</p>
<p>这存在一个问题。就是当你想要运行一个新程序的时候，你并不想要当前进程的复制——你就是想要运行一个不同的程序。这就是 <code>exec()</code> 系统调用做的事情。它用一个全新的程序替代了当前进程。这意味着当你调用<code>exec()</code> 时，操作系统将会终止当前进程，加载新的程序，然后在当前位置启动新的程序。一个程序不会从<code>exec()</code>中获得返回值（除非它报错）。</p>
<p>有了这两个系统调用，我们就有了在 Unix 系统中启动新进程的砖头。首先，一个已存的进程 fork 它本身得到两个一样的进程。然后子进程执行 <code>exec()</code> 来用新程序替换掉它自己。父进程可以继续做其它事情，或者使用<code>wait()</code> 系统调用来等待子进程执行完。</p>
<p>通过上述的背景知识的补充，下面的用于启动一个新程序的代码将会变得很好理解：</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lsh_launch</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **args)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">pid_t</span> pid, wpid;</span><br><span class="line">  <span class="hljs-keyword">int</span> status;</span><br><span class="line"></span><br><span class="line">  pid = fork();</span><br><span class="line">  <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">    <span class="hljs-comment">// Child process</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (execvp(args[<span class="hljs-number">0</span>], args) == <span class="hljs-number">-1</span>) &#123;</span><br><span class="line">      perror(<span class="hljs-string">"lsh"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">    <span class="hljs-comment">// Error forking</span></span><br><span class="line">    perror(<span class="hljs-string">"lsh"</span>);</span><br><span class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// Parent process</span></span><br><span class="line">    <span class="hljs-keyword">do</span> &#123;</span><br><span class="line">      wpid = waitpid(pid, &amp;status, WUNTRACED);</span><br><span class="line">    &#125; <span class="hljs-keyword">while</span> (!WIFEXITED(status) &amp;&amp; !WIFSIGNALED(status));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数将我们之前得到的参数数组作为参数。之后调用<code>fork()</code> ，保存它的返回值。当<code>fork()</code> 返回时，我们实际上有两个正在运行的进程。子进程将会执行第一个 if 条件语句（where pid == 0）。</p>
<p>在子进程中，我们想要运行用户输入的命令。所以，我们使用了<code>exec()</code>的变种之一<code>execvp()</code>。<code>execvp()</code> 略微有一些不同。它将希望运行的程序名和一个字符串数组（也被成为’vector’,这就是其中’v’的由来）作为参数。其中的’p’表示不需要提供运行程序的完整路径，只需要给出它的名字，操作系统将会在系统路径中自动搜索它。</p>
<p>如果 <code>exec</code> 命令返回-1，我们就知道产生了一个 error。所以我们使用<code>perror</code>来打印系统的错误信息，和我们的 Shell 名一样，这样我们就知道这个 error 来自哪里了。之后，我们退出函数，使得 Shell 能继续运行。</p>
<p>第二个条件（pid &lt; 0）检查了是否  <code>fork()</code> 出现了error。如果是，我们打印 error 并继续运行 Shell——这里并没有提示用户出现了 error 并让他们决定是否需要退出。</p>
<p>第三个条件意味着<code>fork()</code> 成功执行了。父进程将会暂时挂起，等待子进程执行完毕。我们使用<code>waitpid()</code> 来等待进程状态的改变。不幸的是，<code>waitpid()</code> 有很多选项（像<code>exec()</code> ）。进程可以通过很多方式改变状态，并不是所有状态的改变都意味着进程结束。一个进程可以是退出（通常会留下错误码），也可以被信号杀死。我们使用<code>waitpid()</code> 提供的宏来等待进程退出或者被杀死。之后该函数将会返回1，作为调用函数的信号来提示应该再次进行输入了。</p>
<h2 id="Shell-内置方法"><a href="#Shell-内置方法" class="headerlink" title="Shell 内置方法"></a>Shell 内置方法</h2><p>你也许已经察觉到了<code>lsh_loop()</code> 函数调用的是<code>lsh_execute()</code> 函数，但是在上一部分我们的函数名为<code>lsh_launch()</code> 。这是故意为之！大部分 Shell 执行的命令会启动一个进程，但并不是所有的命令都需要。它们中的一些就内置在 Shell 中。</p>
<p>比如你想要改变当前目录，你需要使用函数<code>chdir()</code> 。问题在于，目录是当前进程的一项属性。也就是说，如果你写了一个程序调用了<code>cd</code> 改变了目录，它将改变调用程序自己的当前目录。它的父进程的当前目录并没有改变。所以是 Shell 程序自身需要执行<code>chdir()</code> ，来更新它自己的当前目录。这样才能在启动子进程后，子进程们才会继承这个更新后的目录。</p>
<p>类似的，如果程序名为<code>exit</code> ，它将不会退出调用它的 Shell，而是退出直接调用的子进程。这个命令也需要内置在 Shell 里。大部分 Shell 通过运行配置脚本（~/.bashrc）来配置。这些脚本使用能改变 Shell 本身行为的命令。这些命令都是内置在 Shell 里的。</p>
<p>所以我们添加一些命令在 Shell 里是很有意义的。我添加在我的 Shell 里的命令是 cd，exit 和 help。它们的实现如下：</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">  Function Declarations for builtin shell commands:</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lsh_cd</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **args)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lsh_help</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **args)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lsh_exit</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **args)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">  List of builtin commands, followed by their corresponding functions.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">char</span> *builtin_str[] = &#123;</span><br><span class="line">  <span class="hljs-string">"cd"</span>,</span><br><span class="line">  <span class="hljs-string">"help"</span>,</span><br><span class="line">  <span class="hljs-string">"exit"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">int</span> (*builtin_func[]) (<span class="hljs-keyword">char</span> **) = &#123;</span><br><span class="line">  &amp;lsh_cd,</span><br><span class="line">  &amp;lsh_help,</span><br><span class="line">  &amp;lsh_exit</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lsh_num_builtins</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">sizeof</span>(builtin_str) / <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span> *);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">  Builtin function implementations.</span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lsh_cd</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **args)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (args[<span class="hljs-number">1</span>] == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"lsh: expected argument to \"cd\"\n"</span>);</span><br><span class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (chdir(args[<span class="hljs-number">1</span>]) != <span class="hljs-number">0</span>) &#123;</span><br><span class="line">      perror(<span class="hljs-string">"lsh"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lsh_help</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **args)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">int</span> i;</span><br><span class="line">  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Stephen Brennan's LSH\n"</span>);</span><br><span class="line">  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Type program names and arguments, and hit enter.\n"</span>);</span><br><span class="line">  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"The following are built in:\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; lsh_num_builtins(); i++) &#123;</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"  %s\n"</span>, builtin_str[i]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Use the man command for information on other programs.\n"</span>);</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lsh_exit</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **args)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码包含三个部分。第一个部分是内置函数的前向声明。一个前向声明意味着你声明了一个函数（并没有定义），因此你能在定义它之前使用它的函数名。这样做的原因是<code>lsh_help()</code> 使用了内置函数名数组，数组中包含了<code>lsh_help()</code> 。打破这个依赖循环的最清晰的方式就是前向声明。</p>
<p>下一个部分是一个包含了内建命令名的数组以及一个包含命令名对应函数的数组。也就是说，在将来想要添加内建命令的时候只要修改这些数组就好了，不需要在代码的某处地方编辑一个非常复杂的 switch 语句。如果你对<code>builtin_func</code> 的声明感到困惑，那就对了！这是一个包含函数指针的数组，它将字符串数组作为输入并返回一个整型数。在 C 语言里，任何涉及函数指针的声明都是很复杂的，这样做的好处是，当你想要调用一系列函数时可以直接通过数组名加索引调用，而不是用硬编码的方式直接调用函数本身。</p>
<h2 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h2><p>最后要做的就是实现 <code>lsh_execute()</code> ，这个函数将会启动新线程或者调用内置方法。</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lsh_execute</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **args)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">  <span class="hljs-keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (args[<span class="hljs-number">0</span>] == <span class="hljs-literal">NULL</span>) &#123;</span><br><span class="line">    <span class="hljs-comment">// An empty command was entered.</span></span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; lsh_num_builtins(); i++) &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(args[<span class="hljs-number">0</span>], builtin_str[i]) == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> (*builtin_func[i])(args);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> lsh_launch(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码做的就是检查输入命令是否是内置命令，如果是的话就运行它。如果不是则调用<code>lsh_launch()</code> 启动一个新进程。 </p>
<h2 id="整合代码"><a href="#整合代码" class="headerlink" title="整合代码"></a>整合代码</h2><p>到这里一个简易 Shell 所需要的所有代码就都实现了。将上面所有的代码片段复制到 main.c 文件里。在将下列头文件包含在文件起始位置。</p>
<ul>
<li><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;sys/wait.h&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>waitpid()</code> and associated macros</li>
</ul>
</li>
<li><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>chdir()</code></li>
<li><code>fork()</code></li>
<li><code>exec()</code></li>
<li><code>pid_t</code></li>
</ul>
</li>
<li><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>malloc()</code></li>
<li><code>realloc()</code></li>
<li><code>free()</code></li>
<li><code>exit()</code></li>
<li><code>execvp()</code></li>
<li><code>EXIT_SUCCESS</code>, <code>EXIT_FAILURE</code></li>
</ul>
</li>
<li><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>fprintf()</code></li>
<li><code>printf()</code></li>
<li><code>stderr</code></li>
<li><code>getchar()</code></li>
<li><code>perror()</code></li>
</ul>
</li>
<li><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;string.h&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>strcmp()</code></li>
<li><code>strtok()</code></li>
</ul>
<p>保存退出后，执行 <code>gcc -o main main.c</code> 进行编译，然后执行<code>./main</code> 运行，lsh就启动了！</p>
</li>
</ul>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/Linux/">Linux</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>


<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2018/12/14/基于深度学习的图像语义分割综述（译）/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">基于深度学习的图像语义分割综述（译）</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2018/12/07/Kaggle之房价预测/">
                <span class="level-item">Kaggle之房价预测</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comentarios</h3>
        <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en/sdk.js#xfbml=1&version=v2.8";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-comments" data-width="100%" data-href="http://yoursite.com/2018/12/10/自己动手写Shell——C实现/" data-num-posts="5"></div>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    <img class="image is-128x128 has-mb-6" src="/images/wangye.jpeg" alt="彭一峰">
                    
                    <p class="is-size-4 is-block">
                        彭一峰
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        曾在新浪微博、中科院自动化所实习。
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>BeiJing, China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Entradas
                    </p>
                    <p class="title has-text-weight-normal">
                        6
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categorias
                    </p>
                    <p class="title has-text-weight-normal">
                        2
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Etiquetas
                    </p>
                    <p class="title has-text-weight-normal">
                        3
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/MountainOne">
                SEGUIR</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/MountainOne">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Facebook" href="http://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Twitter" href="http://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Dribbble" href="http://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">https://hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/MountainOne" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Github</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">https://github.com/MountainOne</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categorias
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Deep-Learning/">
            <span class="level-start">
                <span class="level-item">Deep Learning</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数据挖掘/">
            <span class="level-start">
                <span class="level-item">数据挖掘</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Nube de etiquetas
        </h3>
        <a href="/tags/Kaggle/" style="font-size: 10px;">Kaggle</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/image-segmentation/" style="font-size: 10px;">image segmentation</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recientes
        </h3>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-19T15:51:37.000Z">2018-12-19</time></div>
                    <a href="/2018/12/19/为Linux添加一个系统调用/" class="has-link-black-ter is-size-6">为Linux添加一个系统调用</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-19T13:34:53.000Z">2018-12-19</time></div>
                    <a href="/2018/12/19/自己动手写Shell——Python实现/" class="has-link-black-ter is-size-6">自己动手写Shell(二)——Python实现</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-14T10:55:01.000Z">2018-12-14</time></div>
                    <a href="/2018/12/14/基于深度学习的图像语义分割综述（译）/" class="has-link-black-ter is-size-6">基于深度学习的图像语义分割综述（译）</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Deep-Learning/">Deep Learning</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-10T14:47:26.000Z">2018-12-10</time></div>
                    <a href="/2018/12/10/自己动手写Shell——C实现/" class="has-link-black-ter is-size-6">自己动手写Shell(一）——C实现</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-06T20:41:32.000Z">2018-12-06</time></div>
                    <a href="/2018/12/07/Kaggle之房价预测/" class="has-link-black-ter is-size-6">Kaggle之房价预测</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/数据挖掘/">数据挖掘</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archivos
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">December 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Etiquetas
            </h3>
            <ul class="menu-list">
                
                <li>
                    <a class="level is-marginless" href="/tags/Kaggle/">
                        <span class="level-start">
                            <span class="level-item">Kaggle</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Linux/">
                        <span class="level-start">
                            <span class="level-item">Linux</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">4</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/image-segmentation/">
                        <span class="level-start">
                            <span class="level-item">image segmentation</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recientes
        </h3>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-19T15:51:37.000Z">2018-12-19</time></div>
                    <a href="/2018/12/19/为Linux添加一个系统调用/" class="has-link-black-ter is-size-6">为Linux添加一个系统调用</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-19T13:34:53.000Z">2018-12-19</time></div>
                    <a href="/2018/12/19/自己动手写Shell——Python实现/" class="has-link-black-ter is-size-6">自己动手写Shell(二)——Python实现</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-14T10:55:01.000Z">2018-12-14</time></div>
                    <a href="/2018/12/14/基于深度学习的图像语义分割综述（译）/" class="has-link-black-ter is-size-6">基于深度学习的图像语义分割综述（译）</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Deep-Learning/">Deep Learning</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-10T14:47:26.000Z">2018-12-10</time></div>
                    <a href="/2018/12/10/自己动手写Shell——C实现/" class="has-link-black-ter is-size-6">自己动手写Shell(一）——C实现</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-06T20:41:32.000Z">2018-12-06</time></div>
                    <a href="/2018/12/07/Kaggle之房价预测/" class="has-link-black-ter is-size-6">Kaggle之房价预测</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/数据挖掘/">数据挖掘</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archivos
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">December 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Etiquetas
            </h3>
            <ul class="menu-list">
                
                <li>
                    <a class="level is-marginless" href="/tags/Kaggle/">
                        <span class="level-start">
                            <span class="level-item">Kaggle</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Linux/">
                        <span class="level-start">
                            <span class="level-item">Linux</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">4</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/image-segmentation/">
                        <span class="level-start">
                            <span class="level-item">image segmentation</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/wangye.jpeg" alt="自己动手写Shell(一）——C实现" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2018 MountainOne&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-icarus">Icarus</a>
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/MountainOne">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Entradas',
                PAGES: 'Pages',
                CATEGORIES: 'Categorias',
                TAGS: 'Etiquetas',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>